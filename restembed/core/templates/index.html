{% extends "base.html" %}
{% block content %}

<style>
td.details-control {
    text-align:center;
    color:forestgreen;
    cursor: pointer;
}
tr.shown td.details-control {
    text-align:center;
    color:red;
}
</style>


<div class="row">
    <div class="col-sm-12 text-center">
        <h4 class="bg-primary text-white p-2">Account Balance</h4>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <table id="account_balance" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>Account Name</th>
                    <th>Type</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-sm-12 text-center">
        <h4 class="bg-primary text-white p-2">Internal Accounts</h4>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <table id="internal_account" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Account Name</th>
                    <th>Source ID</th>
                    <th>Type</th>
                    <th>Product Association</th>
                    <th>External Account Association</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-sm-12 text-center">
        <h4 class="bg-primary text-white p-2">External Accounts</h4>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <table id="external_account" class="table table-striped table-bordered" style="width:100%" data-server-side="true" data-ajax="/api/external/?format=datatables">
            <thead>
                <tr>
                    <th data-data="accountName">Account Name</th>
                    <th data-data="exchangeAssociation">Exchange Name</th>
                    <th data-data="type">Type</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<footer class="footer" style="margin-top: 25px;">
    <div class="container">
        <p class="text-muted text-center">
            Copyright Â© 2020 Lonk.com
        </p>
    </div>
</footer>
{% endblock %}
{% block extra_js %}
<script>
function format ( d ) {
    // `d` is the original data object for the row
    var result = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';
    for (x in d) {
        if ( typeof d[x] != 'string' ) {
            for ( y in d[x] ) {
                result += '<tr><td>' + x + ' ' + y + ':</td><td>' + d[x][y] + '</td></tr>';
            }
        } else {
            result += '<tr><td>' + x + ':</td><td>' + d[x] + '</td></tr>';
        }
    }
    result += '</table>';
    return result;
}

$(document).ready(function() {
    var balance_table = $('#account_balance').DataTable({
        dom:
            "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
            "<'row'<'col-sm-12'tr>>" +
            "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",

        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        "ajax": "/api/balance/?format=datatables",
        "columns": [
            {
                "className":      'details-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": '',
                "render": function () {
                         return '<i class="fa fa-plus-square" aria-hidden="true"></i>';
                },
            },
            {"data": "accountName"},
            {"data": "type"},
        ]
    });

    var table = $('#internal_account').DataTable({
        dom:
            "<'row'<'col-sm-12 col-md-6'B>>" +
            "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
            "<'row'<'col-sm-12'tr>>" +
            "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",

        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],

        "ajax": "/api/internal/?format=datatables",
        "columns": [
            {"data": "accountName"},
            {"data": "sourceId"},
            {"data": "type"},
            {"data": "productAssociation"},
            {"data": "externalAccountAssociation"},
        ]

    });

    $('#account_balance tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var tdi = tr.find("i.fa");
        var row = balance_table.row( tr );

        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
            tdi.first().removeClass('fa-minus-square');
            tdi.first().addClass('fa-plus-square');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
            tdi.first().removeClass('fa-plus-square');
            tdi.first().addClass('fa-minus-square');
        }
    } );


    $('#external_account').DataTable({
        dom:
            "<'row'<'col-sm-12 col-md-6'B>>" +
            "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
            "<'row'<'col-sm-12'tr>>" +
            "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
    });
});
</script>
{% endblock %}
